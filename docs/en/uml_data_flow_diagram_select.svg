<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="827px" preserveAspectRatio="none" style="width:1046px;height:827px;background:#FFFFFF;" version="1.1" viewBox="0 0 1046 827" width="1046px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="26.2969" id="_title" style="stroke:none;stroke-width:1.0;" width="339" x="354.75" y="10"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="329" x="359.75" y="27.9951">BonsaiDB :: Data Flow - SELECT Operation</text><rect fill="#3C7DC4" height="572.3281" style="stroke:#181818;stroke-width:1.0;" width="10" x="274" y="149.7266"/><rect fill="#BA68C8" height="166.7969" style="stroke:#181818;stroke-width:1.0;" width="10" x="549" y="286.3906"/><rect fill="#FFECB3" height="58.2656" style="stroke:#181818;stroke-width:1.0;" width="10" x="770" y="315.5234"/><rect fill="#FFECB3" height="58.2656" style="stroke:#181818;stroke-width:1.0;" width="10" x="770" y="506.4531"/><rect fill="none" height="219.7344" style="stroke:#000000;stroke-width:1.5;" width="1029.5" x="10" y="468.1875"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="56" x2="56" y1="118.5938" y2="747.0547"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="279" x2="279" y1="118.5938" y2="747.0547"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="553.5" x2="553.5" y1="118.5938" y2="747.0547"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="774.5" x2="774.5" y1="118.5938" y2="747.0547"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="961.5" x2="961.5" y1="118.5938" y2="747.0547"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="20" y="115.292">User (CLI)</text><ellipse cx="56" cy="50.7969" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M56,58.7969 L56,85.7969 M43,66.7969 L69,66.7969 M56,85.7969 L43,100.7969 M56,85.7969 L69,100.7969 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="20" y="759.0498">User (CLI)</text><ellipse cx="56" cy="770.8516" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M56,778.8516 L56,805.8516 M43,786.8516 L69,786.8516 M56,805.8516 L43,820.8516 M56,805.8516 L69,820.8516 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#D1E8FF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="128" x="215" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="114" x="222" y="107.292">DatabaseEngine</text><rect fill="#D1E8FF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="128" x="215" y="746.0547"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="114" x="222" y="766.0498">DatabaseEngine</text><rect fill="#E1BEE7" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="85" x="511.5" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="71" x="518.5" y="107.292">BPlusTree</text><rect fill="#E1BEE7" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="85" x="511.5" y="746.0547"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="71" x="518.5" y="766.0498">BPlusTree</text><rect fill="#FFF8E1" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="97" x="726.5" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83" x="733.5" y="107.292">FileManager</text><rect fill="#FFF8E1" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="97" x="726.5" y="746.0547"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83" x="733.5" y="766.0498">FileManager</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="129" x="894.5" y="115.292">Database File (.db)</text><path d="M944,66.2969 C944,56.2969 962,56.2969 962,56.2969 C962,56.2969 980,56.2969 980,66.2969 L980,92.2969 C980,102.2969 962,102.2969 962,102.2969 C962,102.2969 944,102.2969 944,92.2969 L944,66.2969 " fill="#E8F5E9" style="stroke:#181818;stroke-width:1.5;"/><path d="M944,66.2969 C944,76.2969 962,76.2969 962,76.2969 C962,76.2969 980,76.2969 980,66.2969 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="129" x="894.5" y="759.0498">Database File (.db)</text><path d="M944,772.3516 C944,762.3516 962,762.3516 962,762.3516 C962,762.3516 980,762.3516 980,772.3516 L980,798.3516 C980,808.3516 962,808.3516 962,808.3516 C962,808.3516 944,808.3516 944,798.3516 L944,772.3516 " fill="#E8F5E9" style="stroke:#181818;stroke-width:1.5;"/><path d="M944,772.3516 C944,782.3516 962,782.3516 962,782.3516 C962,782.3516 980,782.3516 980,772.3516 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><rect fill="#3C7DC4" height="572.3281" style="stroke:#181818;stroke-width:1.0;" width="10" x="274" y="149.7266"/><rect fill="#BA68C8" height="166.7969" style="stroke:#181818;stroke-width:1.0;" width="10" x="549" y="286.3906"/><rect fill="#FFECB3" height="58.2656" style="stroke:#181818;stroke-width:1.0;" width="10" x="770" y="315.5234"/><rect fill="#FFECB3" height="58.2656" style="stroke:#181818;stroke-width:1.0;" width="10" x="770" y="506.4531"/><polygon fill="#181818" points="262,145.7266,272,149.7266,262,153.7266,266,149.7266" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="56" x2="268" y1="149.7266" y2="149.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="63" y="144.6606">[1]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="44" x="88" y="144.6606">find(id)</text><line style="stroke:#181818;stroke-width:1.0;" x1="284" x2="326" y1="193.9922" y2="193.9922"/><line style="stroke:#181818;stroke-width:1.0;" x1="326" x2="326" y1="193.9922" y2="206.9922"/><line style="stroke:#181818;stroke-width:1.0;" x1="285" x2="326" y1="206.9922" y2="206.9922"/><polygon fill="#181818" points="295,202.9922,285,206.9922,295,210.9922,291,206.9922" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="291" y="181.3599">[2]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86" x="316" y="173.7935">lock.acquire()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="316" y="188.9263">(Shared lock)</text><path d="M289,219.9922 L289,259.9922 L521,259.9922 L521,229.9922 L511,219.9922 L289,219.9922 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M511,219.9922 L511,229.9922 L521,229.9922 L511,219.9922 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211" x="295" y="237.0591">Allows multiple concurrent reads,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110" x="295" y="252.1919">but blocks writes.</text><polygon fill="#181818" points="537,282.3906,547,286.3906,537,290.3906,541,286.3906" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="284" x2="543" y1="286.3906" y2="286.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="291" y="281.3247">[3]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="316" y="281.3247">search(id)</text><polygon fill="#181818" points="758,311.5234,768,315.5234,758,319.5234,762,315.5234" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="559" x2="764" y1="315.5234" y2="315.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="566" y="310.4575">[4]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="591" y="310.4575">read_node(node_page_id)</text><polygon fill="#181818" points="950,340.6563,960,344.6563,950,348.6563,954,344.6563" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="780" x2="956" y1="344.6563" y2="344.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="787" y="339.5903">[5]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="812" y="339.5903">Reads index nodes</text><line style="stroke:#181818;stroke-width:1.0;" x1="776" x2="786" y1="373.7891" y2="369.7891"/><line style="stroke:#181818;stroke-width:1.0;" x1="776" x2="786" y1="373.7891" y2="377.7891"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="775" x2="961" y1="373.7891" y2="373.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="792" y="368.7231">[6]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70" x="817" y="368.7231">Index node</text><path d="M379,386.7891 L379,426.7891 L544,426.7891 L544,396.7891 L534,386.7891 L379,386.7891 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M534,386.7891 L534,396.7891 L544,396.7891 L534,386.7891 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="385" y="403.856">Navigates the B+ tree</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="385" y="418.9888">on disk to find the key.</text><line style="stroke:#181818;stroke-width:1.0;" x1="285" x2="295" y1="453.1875" y2="449.1875"/><line style="stroke:#181818;stroke-width:1.0;" x1="285" x2="295" y1="453.1875" y2="457.1875"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="284" x2="553" y1="453.1875" y2="453.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="301" y="448.1216">[7]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="326" y="448.1216">page_id found/nullopt</text><path d="M10,468.1875 L74,468.1875 L74,475.3203 L64,485.3203 L10,485.3203 L10,468.1875 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="219.7344" style="stroke:#000000;stroke-width:1.5;" width="1029.5" x="10" y="468.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="25" y="481.2544">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="101" x="89" y="480.3979">[page_id found]</text><polygon fill="#181818" points="758,502.4531,768,506.4531,758,510.4531,762,506.4531" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="284" x2="764" y1="506.4531" y2="506.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="291" y="501.3872">[8]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="316" y="501.3872">readPage(page_id)</text><polygon fill="#181818" points="950,531.5859,960,535.5859,950,539.5859,954,535.5859" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="780" x2="956" y1="535.5859" y2="535.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="787" y="530.52">[9]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="812" y="530.52">Reads the data page</text><line style="stroke:#181818;stroke-width:1.0;" x1="776" x2="786" y1="564.7188" y2="560.7188"/><line style="stroke:#181818;stroke-width:1.0;" x1="776" x2="786" y1="564.7188" y2="568.7188"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="775" x2="961" y1="564.7188" y2="564.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="30" x="792" y="559.6528">[10]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="826" y="559.6528">Page with records</text><line style="stroke:#181818;stroke-width:1.0;" x1="284" x2="326" y1="593.8516" y2="593.8516"/><line style="stroke:#181818;stroke-width:1.0;" x1="326" x2="326" y1="593.8516" y2="606.8516"/><line style="stroke:#181818;stroke-width:1.0;" x1="285" x2="326" y1="606.8516" y2="606.8516"/><polygon fill="#181818" points="295,602.8516,285,606.8516,295,610.8516,291,606.8516" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="30" x="291" y="588.7856">[11]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="217" x="325" y="588.7856">Deserialize records from the page</text><line style="stroke:#181818;stroke-width:1.0;" x1="57" x2="67" y1="635.9844" y2="631.9844"/><line style="stroke:#181818;stroke-width:1.0;" x1="57" x2="67" y1="635.9844" y2="639.9844"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="56" x2="273" y1="635.9844" y2="635.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="30" x="73" y="630.9185">[12]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="107" y="630.9185">return optional&lt;Record&gt;</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="1039.5" y1="644.9844" y2="644.9844"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="126" x="15" y="655.1948">[page_id not found]</text><line style="stroke:#181818;stroke-width:1.0;" x1="57" x2="67" y1="679.9219" y2="675.9219"/><line style="stroke:#181818;stroke-width:1.0;" x1="57" x2="67" y1="679.9219" y2="683.9219"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="56" x2="273" y1="679.9219" y2="679.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="30" x="73" y="674.856">[13]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86" x="107" y="674.856">return nullopt</text><line style="stroke:#181818;stroke-width:1.0;" x1="284" x2="326" y1="721.0547" y2="721.0547"/><line style="stroke:#181818;stroke-width:1.0;" x1="326" x2="326" y1="721.0547" y2="734.0547"/><line style="stroke:#181818;stroke-width:1.0;" x1="279" x2="326" y1="734.0547" y2="734.0547"/><polygon fill="#181818" points="289,730.0547,279,734.0547,289,738.0547,285,734.0547" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="30" x="291" y="715.9888">[14]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86" x="325" y="715.9888">lock.release()</text><!--MD5=[24016b203b563b01d5c89e963a4afa38]
@startuml
title **BonsaiDB :: Data Flow - SELECT Operation**
autonumber "<b>[0]</b>"

actor "User (CLI)" as User
participant "DatabaseEngine" as Engine #D1E8FF
participant "BPlusTree" as BTree #E1BEE7
participant "FileManager" as FM #FFF8E1
database "Database File (.db)" as DB #E8F5E9

User -> Engine: find(id)
activate Engine #3C7DC4

Engine -> Engine: lock.acquire()\n(Shared lock)
note right of Engine: Allows multiple concurrent reads,\nbut blocks writes.

Engine -> BTree: search(id)
activate BTree #BA68C8

BTree -> FM: read_node(node_page_id)
activate FM #FFECB3
FM -> DB: Reads index nodes
DB - ->> FM: Index node
deactivate FM

note left of BTree: Navigates the B+ tree\non disk to find the key.

BTree - ->> Engine: page_id found/nullopt
deactivate BTree

alt page_id found
    Engine -> FM: readPage(page_id)
    activate FM #FFECB3
    FM -> DB: Reads the data page
    DB - ->> FM: Page with records
    deactivate FM

    Engine -> Engine: Deserialize records from the page
    Engine - ->> User: return optional<Record>
else page_id not found
    Engine - ->> User: return nullopt
end

Engine -> Engine: lock.release()
deactivate Engine
@enduml

PlantUML version 1.2022.7(Mon Aug 22 17:01:30 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>